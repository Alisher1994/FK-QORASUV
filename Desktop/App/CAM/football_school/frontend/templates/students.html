<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—á–µ–Ω–∏–∫–∏</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>‚öΩ {{ system_name }}</h2>
            <button class="sidebar-toggle" aria-label="–°–≤–µ—Ä–Ω—É—Ç—å –º–µ–Ω—é">‚ò∞</button>
        </div>
        <nav>
            <a href="{{ url_for('dashboard') }}" data-tooltip="–ì–ª–∞–≤–Ω–∞—è">üìä <span>–ì–ª–∞–≤–Ω–∞—è</span></a>
            <a href="{{ url_for('students') }}" class="active" data-tooltip="–£—á–µ–Ω–∏–∫–∏">üë• <span>–£—á–µ–Ω–∏–∫–∏</span></a>
            <a href="{{ url_for('groups_page') }}" data-tooltip="–ì—Ä—É–ø–ø—ã">üë®‚Äçüë©‚Äçüë¶ <span>–ì—Ä—É–ø–ø—ã</span></a>
            <a href="{{ url_for('tariffs_page') }}" data-tooltip="–¢–∞—Ä–∏—Ñ—ã">üí≥ <span>–¢–∞—Ä–∏—Ñ—ã</span></a>
            <a href="{{ url_for('finances_page') }}" data-tooltip="–§–∏–Ω–∞–Ω—Å—ã">üí∞ <span>–§–∏–Ω–∞–Ω—Å—ã</span></a>
            <a href="{{ url_for('attendance_page') }}" data-tooltip="–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å">üìã <span>–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</span></a>
            <a href="{{ url_for('camera_page') }}" data-tooltip="–ö–∞–º–µ—Ä–∞">üì∑ <span>–ö–∞–º–µ—Ä–∞</span></a>
            <a href="{{ url_for('rewards_page') }}" data-tooltip="–í–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è">üèÜ <span>–í–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è</span></a>
            <a href="{{ url_for('rating_page') }}" data-tooltip="–†–µ–π—Ç–∏–Ω–≥ —É—á–µ–Ω–∏–∫–æ–≤">‚≠ê <span>–†–µ–π—Ç–∏–Ω–≥ —É—á–µ–Ω–∏–∫–æ–≤</span></a>
            <a href="{{ url_for('club_settings_page') }}" data-tooltip="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span></a>
            <a href="{{ url_for('logout') }}" data-tooltip="–í—ã—Ö–æ–¥">üö™ <span>–í—ã—Ö–æ–¥</span></a>
        </nav>
    </div>

    <div class="main-content">
        <div class="page-header">
            <h1>üë• –£—á–µ–Ω–∏–∫–∏</h1>
            <div style="display: flex; gap: 12px; align-items: center;">
                <button id="filterToggleBtn" class="btn-secondary" style="display: flex; align-items: center; gap: 8px;">
                    <span>üîç</span>
                    <span id="filterToggleText">–§–∏–ª—å—Ç—Ä</span>
                </button>
                <button id="addStudentBtn" class="btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</button>
            </div>
        </div>
        
        <!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
        <div id="filterPanel" class="filter-panel" style="display: none;">
            <div class="filter-panel-content">
                <div class="filter-row">
                    <div class="filter-group">
                        <label>üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏</label>
                        <input type="text" id="filterName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–ª–∏ —Ñ–∞–º–∏–ª–∏—é...">
                    </div>
                    <div class="filter-group">
                        <label>üë®‚Äçüë©‚Äçüë¶ –ì—Ä—É–ø–ø–∞</label>
                        <select id="filterGroup">
                            <option value="">–í—Å–µ –≥—Ä—É–ø–ø—ã</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>üìä –°—Ç–∞—Ç—É—Å</label>
                        <select id="filterStatus">
                            <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                            <option value="active">–ê–∫—Ç–∏–≤–µ–Ω</option>
                            <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</option>
                            <option value="blacklist">–ß—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>üí∞ –ë–∞–ª–∞–Ω—Å</label>
                        <select id="filterBalance">
                            <option value="">–í—Å–µ</option>
                            <option value="low">–ú–∞–ª–æ –∑–∞–Ω—è—Ç–∏–π (‚â§2)</option>
                            <option value="normal">–ù–æ—Ä–º–∞–ª—å–Ω—ã–π (>2)</option>
                            <option value="club">–ö–ª—É–±–Ω–æ–µ —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                        </select>
                    </div>
                </div>
                <div class="filter-actions">
                    <button type="button" id="clearFiltersBtn" class="btn-secondary">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
                    <button type="button" id="applyFiltersBtn" class="btn-primary">‚úì –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>
        
        <table class="data-table" id="studentsTable">
            <thead>
                <tr>
                    <th>–§–æ—Ç–æ</th>
                    <th>–ù–æ–º–µ—Ä</th>
                    <th>–ò–º—è</th>
                    <th>–ì—Ä—É–ø–ø–∞</th>
                    <th>–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è</th>
                    <th>–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è</th>
                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                    <th>–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–ø–ª–∞—Ç—ã</th>
                    <th>–°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã</th>
                    <th>–î–æ–ª–≥</th>
                    <th>–ë–∞–ª–∞–Ω—Å</th>
                    <th>–ë–∞–ª–ª—ã</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                {% set balance_value = balances.get(student.id) if balances else 0 %}
                <tr class="{% if balance_value <= 2 %}low-balance{% endif %} {% if student.status == 'blacklist' %}blacklisted{% endif %}" data-student-id="{{ student.id }}" data-group-id="{{ student.group_id or '' }}" data-status="{{ student.status }}">
                    <td>
                        {% if student.photo_path %}
                        <img src="{{ url_for('static', filename=student.photo_path.replace('frontend/static/', '').replace('\\', '/')) }}" class="student-avatar">
                        {% else %}
                        <div class="avatar-placeholder">üë§</div>
                        {% endif %}
                    </td>
                    <td><strong>{{ student.student_number }}</strong></td>
                    {% set payment = payment_info.get(student.id) if payment_info else None %}
                    <td>{{ student.full_name }}</td>
                    <td>{{ student.group.name if student.group else '–ë–µ–∑ –≥—Ä—É–ø–ø—ã' }}</td>
                    <td>{{ student.birth_year or '-' }}</td>
                    <td>{{ student.admission_date|format_date if student.admission_date else '-' }}</td>
                    <td>{{ student.phone or '-' }}</td>
                    <td>{{ payment.date if payment and payment.date else '-' }}</td>
                    <td>
                        {% if payment is not none and payment.amount is not none %}
                            {{ payment.amount|format_thousand }}
                        {% else %}-{% endif %}
                    </td>
                    <td>
                        {% if payment is not none and payment.debt is not none %}
                            {{ payment.debt|format_thousand }}
                        {% else %}-{% endif %}
                    </td>
                    <td>
                        {% if student.club_funded %}
                        <span class="balance-badge" style="background: #9b59b6;">‚ôæÔ∏è –ö–ª—É–±</span>
                        {% else %}
                        <span class="balance-badge {% if balance_value <= 2 %}low{% endif %}">
                            {{ balance_value|format_thousand }}
                        </span>
                        {% endif %}
                    </td>
                    <td>
                        {% set points = student_points.get(student.id) if student_points else 0 %}
                        <span class="points-badge" style="cursor: pointer; color: #f39c12; font-weight: bold;" data-student-id="{{ student.id }}" onclick="showRewardsHistory({{ student.id }})">
                            ‚≠ê {{ points }}
                        </span>
                    </td>
                    <td>
                        {% if student.status == 'active' %}
                        <span style="color: #27ae60;">‚úì –ê–∫—Ç–∏–≤–µ–Ω</span>
                        {% elif student.status == 'inactive' %}
                        <span style="color: #95a5a6;">‚óã –ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                        {% elif student.status == 'blacklist' %}
                        <span style="color: #e74c3c;">‚ö†Ô∏è –ß–°</span>
                        {% endif %}
                    </td>
                    <td class="action-buttons">
                        <button class="btn-small btn-warning give-reward-btn" data-student-id="{{ student.id }}" title="–í—ã–¥–∞—Ç—å –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ">‚≠ê</button>
                        <button class="btn-small btn-success add-payment-btn" data-student-id="{{ student.id }}">üí≥</button>
                        <button class="btn-small btn-info edit-student-btn" data-student-id="{{ student.id }}">‚úèÔ∏è</button>
                        <button class="btn-small btn-danger delete-student-btn" data-student-id="{{ student.id }}" data-student-name="{{ student.full_name }}">üóëÔ∏è</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞ -->
    <div id="addStudentModal" class="modal">
        <div class="modal-content add-student-modal-content" style="max-width: 1600px; max-height: 95vh; overflow-y: auto;">
            <span class="close">&times;</span>
            <h2>–î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</h2>
            
            <form id="addStudentForm" enctype="multipart/form-data">
                <div class="form-columns" style="display: grid; grid-template-columns: 1.2fr 1.2fr 1fr; gap: 24px; align-items: start;">
                    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
                    <div>
                        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="form-block">
                            <h3>üë§ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                            <div class="form-group">
                                <label>–§–∞–º–∏–ª–∏—è *</label>
                                <input type="text" name="last_name" id="last_name" required placeholder="–ò–≤–∞–Ω–æ–≤">
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>–ò–º—è *</label>
                                    <input type="text" name="first_name" id="first_name" required placeholder="–ò–≤–∞–Ω">
                                </div>
                                <div class="form-group">
                                    <label>–û—Ç—á–µ—Å—Ç–≤–æ</label>
                                    <input type="text" name="middle_name" id="middle_name" placeholder="–ò–≤–∞–Ω–æ–≤–∏—á">
                                </div>
                            </div>
                            <input type="hidden" name="full_name" id="full_name_hidden">

                            <div class="form-group">
                                <label>‚Ññ —à–∫–æ–ª—ã</label>
                                <input type="text" name="school_number" placeholder="–®–∫–æ–ª–∞ ‚Ññ 12">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>–¢–µ–ª–µ—Ñ–æ–Ω —É—á–µ–Ω–∏–∫–∞</label>
                                    <input type="tel" name="phone" placeholder="+998 XX XXX XX XX">
                                </div>
                                <div class="form-group">
                                    <label>–¢–µ–ª–µ—Ñ–æ–Ω —Ä–æ–¥–∏—Ç–µ–ª—è</label>
                                    <input type="tel" name="parent_phone" placeholder="+998 XX XXX XX XX">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>–§–æ—Ç–æ *</label>
                                <div class="photo-upload-container" id="add-photo-upload" tabindex="0">
                                    <input type="file" name="photo" id="add_photo_input" accept="image/*" required style="display: none;">
                                    <div class="photo-upload-area" id="add-photo-area">
                                        <div class="photo-preview" id="add-photo-preview">
                                            <div class="photo-placeholder">
                                                <button type="button" class="photo-select-btn" id="add-photo-select-btn">
                                                    <span class="photo-select-icon">+</span>
                                                    <span class="photo-select-text">–í—ã–±—Ä–∞—Ç—å</span>
                                                </button>
                                                <small class="photo-hint">–ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ (Ctrl+V)</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <small>–§–æ—Ç–æ –¥–æ–ª–∂–Ω–æ —á—ë—Ç–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏—Ü–æ</small>
                            </div>
                        </div>
                        
                        <!-- –ê–¥—Ä–µ—Å -->
                        <div class="form-block">
                            <h3>üìç –ê–¥—Ä–µ—Å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>–ì–æ—Ä–æ–¥</label>
                                    <select name="city" id="citySelect">
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>–†–∞–π–æ–Ω</label>
                                    <select name="district" id="districtSelect" disabled>
                                        <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>–£–ª–∏—Ü–∞</label>
                                    <input type="text" name="street" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —É–ª–∏—Ü—ã">
                                </div>
                                <div class="form-group">
                                    <label>–î–æ–º/–ö–≤–∞—Ä—Ç–∏—Ä–∞</label>
                                    <input type="text" name="house_number" placeholder="–î–æ–º 12, –∫–≤. 45">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –°—Ä–µ–¥–Ω—è—è –∫–æ–ª–æ–Ω–∫–∞ -->
                    <div>
                        <!-- –£—á–µ–±–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
                        <div class="form-block">
                            <h3>üìå –£—á–µ–±–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                            <div class="form-group">
                                <label>–ù–æ–º–µ—Ä —É—á–µ–Ω–∏–∫–∞ *</label>
                                <input type="text" name="student_number" required placeholder="ST0001">
                                <small>–í–≤–µ–¥–∏—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</small>
                            </div>

                            <div class="form-group">
                                <label>–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è</label>
                                <input type="date" name="admission_date" id="admission_date">
                            </div>

                            <div class="form-group">
                                <label>–ì—Ä—É–ø–ø–∞</label>
                                <select name="group_id" id="groupSelect">
                                    <option value="">–ë–µ–∑ –≥—Ä—É–ø–ø—ã</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>–°—Ç–∞—Ç—É—Å</label>
                                <select name="status" id="statusSelect" onchange="toggleBlacklistReason()">
                                    <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                                    <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π</option>
                                    <option value="blacklist">–ß—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫</option>
                                </select>
                            </div>

                            <div class="form-group" id="blacklistReasonBlock" style="display: none;">
                                <label>–ü—Ä–∏—á–∏–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —á—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫</label>
                                <textarea name="blacklist_reason" rows="3" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É..."></textarea>
                            </div>
                        </div>

                        <!-- –ü–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
                        <div class="form-block">
                            <h3>üÜî –ü–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                            <div class="form-row three-col">
                                <div class="form-group">
                                    <label>–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                                    <input type="number" name="birth_year" min="1900" max="2025" placeholder="2010">
                                </div>
                                <div class="form-group">
                                    <label>–°–µ—Ä–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞</label>
                                    <input type="text" name="passport_series" placeholder="AA">
                                </div>
                                <div class="form-group">
                                    <label>–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞</label>
                                    <input type="text" name="passport_number" placeholder="1234567">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>–ö–µ–º –≤—ã–¥–∞–Ω</label>
                                <input type="text" name="passport_issued_by" placeholder="–ú–í–î –†–£–∑">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</label>
                                    <input type="date" name="passport_issue_date">
                                </div>
                                <div class="form-group">
                                    <label>–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</label>
                                    <input type="date" name="passport_expiry_date">
                                </div>
                            </div>
                        </div>
                    </div>
                        
                    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
                    <div>
                        <!-- –¢–∞—Ä–∏—Ñ -->
                        <div class="form-block">
                            <h3>üí≥ –¢–∞—Ä–∏—Ñ</h3>
                            <div class="form-group">
                                <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ *</label>
                                <select name="tariff_id" id="tariffSelect" required>
                                    <option value="">–ë–µ–∑ —Ç–∞—Ä–∏—Ñ–∞</option>
                                </select>
                            </div>
                        </div>

                        <!-- –§–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ -->
                        <div class="form-block">
                            <h3>üí∞ –§–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="club_funded" value="true">
                                    <span>–§–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞ —Å—á—ë—Ç –∫–ª—É–±–∞</span>
                                </label>
                                <small style="display: block; margin-top: 5px; color: #7f8c8d;">
                                    –£—á–µ–Ω–∏–∫ –º–æ–∂–µ—Ç –ø–æ—Å–µ—â–∞—Ç—å –∑–∞–Ω—è—Ç–∏—è –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn-primary btn-large" style="margin-top: 20px; width: 100%;">‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—á–µ–Ω–∏–∫–∞ -->
    <div id="editStudentModal" class="modal">
        <div class="modal-content edit-student-modal-content" style="max-width: 1600px; max-height: 95vh; overflow-y: auto;">
            <span class="close">&times;</span>
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—á–µ–Ω–∏–∫–∞</h2>
            
            <form id="editStudentForm" enctype="multipart/form-data">
                <input type="hidden" id="edit_student_id">
                
                <div class="form-columns" style="display: grid; grid-template-columns: 1.2fr 1.2fr 1fr; gap: 24px; align-items: start;">
                    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
                    <div>
                        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="form-block">
                            <h3>üë§ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                            <div class="form-group">
                                <label>–§–∞–º–∏–ª–∏—è *</label>
                                <input type="text" id="edit_last_name" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>–ò–º—è *</label>
                                    <input type="text" id="edit_first_name" required>
                                </div>
                                <div class="form-group">
                                    <label>–û—Ç—á–µ—Å—Ç–≤–æ</label>
                                    <input type="text" id="edit_middle_name" placeholder="–ò–≤–∞–Ω–æ–≤–∏—á">
                                </div>
                            </div>
                            <input type="hidden" id="edit_full_name" name="full_name" required>

                            <div class="form-group">
                                <label>‚Ññ —à–∫–æ–ª—ã</label>
                                <input type="text" id="edit_school_number" name="school_number" placeholder="–®–∫–æ–ª–∞ ‚Ññ 12">
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                    <input type="tel" id="edit_phone" name="phone" placeholder="+998 90 123 45 67">
                                </div>
                                <div class="form-group">
                                    <label>–¢–µ–ª–µ—Ñ–æ–Ω —Ä–æ–¥–∏—Ç–µ–ª—è</label>
                                    <input type="tel" id="edit_parent_phone" name="parent_phone" placeholder="+998 90 123 45 67">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>–§–æ—Ç–æ (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å)</label>
                                <div class="photo-upload-container" id="edit-photo-upload" tabindex="0">
                                    <input type="file" id="edit_photo" name="photo" accept="image/*" style="display: none;">
                                    <div class="photo-upload-area" id="edit-photo-area">
                                        <div class="photo-preview" id="edit-photo-preview">
                                            <div class="photo-placeholder">
                                                <button type="button" class="photo-select-btn" id="edit-photo-select-btn">
                                                    <span class="photo-select-icon">+</span>
                                                    <span class="photo-select-text">–í—ã–±—Ä–∞—Ç—å</span>
                                                </button>
                                                <small class="photo-hint">–ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ (Ctrl+V)</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- –ê–¥—Ä–µ—Å -->
                        <div class="form-block">
                            <h3>üìç –ê–¥—Ä–µ—Å</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>–ì–æ—Ä–æ–¥</label>
                                    <select id="edit_citySelect" name="city">
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>–†–∞–π–æ–Ω</label>
                                    <select id="edit_districtSelect" name="district" disabled>
                                        <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>–£–ª–∏—Ü–∞</label>
                                    <input type="text" id="edit_street" name="street">
                                </div>
                                <div class="form-group">
                                    <label>–î–æ–º</label>
                                    <input type="text" id="edit_house_number" name="house_number">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –°—Ä–µ–¥–Ω—è—è –∫–æ–ª–æ–Ω–∫–∞ -->
                    <div>
                        <!-- –£—á–µ–±–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
                        <div class="form-block">
                            <h3>üìå –£—á–µ–±–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                            <div class="form-group">
                                <label>–ù–æ–º–µ—Ä —É—á–µ–Ω–∏–∫–∞ *</label>
                                <input type="text" id="edit_student_number" name="student_number" required>
                                <small>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä, –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º</small>
                            </div>

                            <div class="form-group">
                                <label>–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è</label>
                                <input type="date" id="edit_admission_date" name="admission_date">
                            </div>

                            <div class="form-group">
                                <label>–ì—Ä—É–ø–ø–∞</label>
                                <select id="edit_groupSelect" name="group_id">
                                    <option value="">–ë–µ–∑ –≥—Ä—É–ø–ø—ã</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>–°—Ç–∞—Ç—É—Å</label>
                                <select id="edit_statusSelect" name="status" onchange="toggleEditBlacklistReason()">
                                    <option value="active">–ê–∫—Ç–∏–≤–µ–Ω</option>
                                    <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</option>
                                    <option value="blacklist">–ß—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫</option>
                                </select>
                            </div>

                            <div id="edit_blacklistReasonBlock" class="form-group" style="display: none;">
                                <label>–ü—Ä–∏—á–∏–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —á—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫</label>
                                <textarea id="edit_blacklist_reason" name="blacklist_reason" rows="3" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É..."></textarea>
                            </div>
                        </div>

                        <!-- –ü–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
                        <div class="form-block">
                            <h3>üìÑ –ü–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                            <div class="form-group">
                                <label>–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                                <input type="number" id="edit_birth_year" name="birth_year" min="1950" max="2020" placeholder="2010">
                            </div>
                            
                            <div class="form-row three-col">
                                <div class="form-group">
                                    <label>–°–µ—Ä–∏—è</label>
                                    <input type="text" id="edit_passport_series" name="passport_series" placeholder="AB">
                                </div>
                                <div class="form-group">
                                    <label>–ù–æ–º–µ—Ä</label>
                                    <input type="text" id="edit_passport_number" name="passport_number" placeholder="1234567">
                                </div>
                                <div class="form-group">
                                    <label>–ö–µ–º –≤—ã–¥–∞–Ω</label>
                                    <input type="text" id="edit_passport_issued_by" name="passport_issued_by" placeholder="IIB">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏</label>
                                    <input type="date" id="edit_passport_issue_date" name="passport_issue_date">
                                </div>
                                <div class="form-group">
                                    <label>–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</label>
                                    <input type="date" id="edit_passport_expiry_date" name="passport_expiry_date">
                                </div>
                            </div>
                        </div>
                    </div>
                        
                    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
                    <div>
                        <!-- –¢–∞—Ä–∏—Ñ -->
                        <div class="form-block">
                            <h3>üí≥ –¢–∞—Ä–∏—Ñ</h3>
                            <div class="form-group">
                                <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ *</label>
                                <select id="edit_tariffSelect" name="tariff_id" required>
                                    <option value="">–ë–µ–∑ —Ç–∞—Ä–∏—Ñ–∞</option>
                                </select>
                            </div>
                        </div>

                        <!-- –§–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ -->
                        <div class="form-block">
                            <h3>üí∞ –§–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="edit_club_funded" name="club_funded" value="true">
                                    <span>–§–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞ —Å—á—ë—Ç –∫–ª—É–±–∞</span>
                                </label>
                                <small style="display: block; margin-top: 5px; color: #7f8c8d;">
                                    –£—á–µ–Ω–∏–∫ –º–æ–∂–µ—Ç –ø–æ—Å–µ—â–∞—Ç—å –∑–∞–Ω—è—Ç–∏—è –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn-primary btn-large" style="margin-top: 20px; width: 100%;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –û–ø–ª–∞—Ç–∞ -->
    <div id="paymentModal" class="modal">
        <div class="modal-content payment-modal-content" style="max-width: 1000px;">
            <span class="close">&times;</span>
            <div class="payment-modal-header">
                <div class="payment-modal-icon">üí≥</div>
                <div>
                    <h2 class="payment-modal-title">–î–æ–±–∞–≤–∏—Ç—å –æ–ø–ª–∞—Ç—É</h2>
                    <p class="payment-modal-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—è—Ü –¥–ª—è –∑–∞–ø–∏—Å–∏ –æ–ø–ª–∞—Ç—ã</p>
                </div>
            </div>
            
            <form id="paymentForm">
                <input type="hidden" id="payment_student_id">
                <input type="hidden" id="student_tariff_price">
                
                <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≥–æ–¥–∞ -->
                <div class="payment-year-navigation">
                    <button type="button" class="payment-year-btn" id="prevYearBtn">
                        <span class="year-arrow">‚Üê</span>
                        <span id="prevYear"></span>
                    </button>
                    <div class="payment-year-display">
                        <span id="currentYear" class="current-year-text"></span>
                    </div>
                    <button type="button" class="payment-year-btn" id="nextYearBtn">
                        <span id="nextYear"></span>
                        <span class="year-arrow">‚Üí</span>
                    </button>
                </div>

                <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç: –º–µ—Å—è—Ü—ã —Å–ª–µ–≤–∞, —Ñ–æ—Ä–º–∞ —Å–ø—Ä–∞–≤–∞ -->
                <div class="payment-content-layout">
                    <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: —Å–ø–∏—Å–æ–∫ –º–µ—Å—è—Ü–µ–≤ -->
                    <div class="payment-months-container">
                        <div id="monthlyPayments" class="payment-months-list">
                            <!-- –ú–µ—Å—è—Ü—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                        </div>
                    </div>

                    <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: —Ñ–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã -->
                    <div id="paymentInputSection" class="payment-input-section" style="display: none;">
                        <div class="payment-input-header">
                            <h3>–û–ø–ª–∞—Ç–∞ –∑–∞ <span id="selectedMonthName" class="selected-month-name"></span></h3>
                        </div>
                        
                        <!-- –ò—Å—Ç–æ—Ä–∏—è —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ–ø–ª–∞—Ç -->
                        <div id="partialPaymentsHistory" class="partial-payments-history">
                            <!-- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>
                                    <span style="margin-right: 6px;">üìÖ</span>
                                    –î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã
                                </label>
                                <input type="date" id="payment_date" required class="form-input-modern">
                            </div>
                            <div class="form-group">
                                <label>
                                    <span style="margin-right: 6px;">üí∞</span>
                                    –°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã (—Å—É–º) *
                                </label>
                                <input type="number" id="payment_amount" required min="0" step="1000" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" class="form-input-modern">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                <span style="margin-right: 6px;">üìù</span>
                                –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ
                            </label>
                            <textarea id="payment_notes" rows="3" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –æ–ø–ª–∞—Ç–µ" class="form-input-modern"></textarea>
                        </div>

                        <div class="payment-form-actions">
                            <button type="submit" class="btn-payment-submit">
                                <span class="btn-icon">üí∞</span>
                                <span>–î–æ–±–∞–≤–∏—Ç—å –æ–ø–ª–∞—Ç—É</span>
                            </button>
                        </div>
                    </div>

                    <!-- –ï—Å–ª–∏ –º–µ—Å—è—Ü –Ω–µ –≤—ã–±—Ä–∞–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É —Å–ø—Ä–∞–≤–∞ -->
                    <div id="noMonthSelected" class="payment-no-selection">
                        <div class="no-selection-icon">üëÜ</div>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—è—Ü –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã</p>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø–ª–∞—Ç—É -->
    <div id="editPaymentModal" class="modal">
        <div class="modal-content simple-modal" style="max-width: 600px;">
            <span class="close edit-payment-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</span>
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø–ª–∞—Ç—É</h2>
            <form id="editPaymentForm">
                <input type="hidden" id="edit_payment_id">
                <div class="form-row">
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã</label>
                        <input type="date" id="edit_payment_date" required>
                    </div>
                    <div class="form-group">
                        <label>–°—É–º–º–∞ (—Å—É–º) *</label>
                        <input type="number" id="edit_payment_amount" min="1" step="1000" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
                    <textarea id="edit_payment_notes" rows="2"></textarea>
                </div>
                <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –í—ã–¥–∞—Ç—å –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ -->
    <div id="giveRewardModal" class="modal">
        <div class="modal-content simple-modal" style="max-width: 500px;">
            <span class="close give-reward-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</span>
            <h2>‚≠ê –í—ã–¥–∞—Ç—å –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ</h2>
            <p id="reward-student-name" style="font-size: 16px; margin-bottom: 20px; color: #2c3e50;"></p>
            <form id="giveRewardForm">
                <input type="hidden" id="reward_student_id">
                <div class="form-group">
                    <label>–¢–∏–ø –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è *</label>
                    <select id="reward_type_select" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è</option>
                        <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                    </select>
                </div>
                <button type="submit" class="btn-primary btn-large" style="width: 100%;">‚≠ê –í—ã–¥–∞—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –ò—Å—Ç–æ—Ä–∏—è –±–∞–ª–ª–æ–≤ -->
    <div id="rewardsHistoryModal" class="modal">
        <div class="modal-content simple-modal" style="max-width: 600px;">
            <span class="close rewards-history-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</span>
            <h2>‚≠ê –ò—Å—Ç–æ—Ä–∏—è –±–∞–ª–ª–æ–≤</h2>
            <p id="history-student-name" style="font-size: 16px; margin-bottom: 20px; color: #2c3e50;"></p>
            <div id="rewardsHistoryList" style="max-height: 400px; overflow-y: auto;">
                <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/students.js') }}"></script>
    <script src="{{ url_for('static', filename='js/students_rewards.js') }}"></script>
    <script src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
</body>
</html>
